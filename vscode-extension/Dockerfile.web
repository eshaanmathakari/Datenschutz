# Dockerfile for web interface (optional)
FROM python:3.11-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
    build-essential \
    curl \
    git \
    && rm -rf /var/lib/apt/lists/*

# Install Python dependencies
RUN pip install --no-cache-dir \
    flask==3.0.3 \
    flask-cors==4.0.1 \
    python-dotenv==1.0.1 \
    llama-cpp-python==0.2.86 \
    transformers==4.42.4 \
    torch \
    accelerate==0.33.0 \
    sentencepiece==0.2.0 \
    safetensors==0.4.3 \
    orjson==3.10.7 \
    rapidfuzz==3.9.6

# Create app directory
WORKDIR /app

# Copy the original analyzer backend
COPY ../analyzer/ ./analyzer/

# Create a simple web interface
COPY web-interface/ ./web-interface/

# Set environment variables
ENV PYTHONPATH=/app
ENV MODEL_BACKEND=none
ENV DEFAULT_SCAN_PATH=/workspace
ENV LOG_RETENTION_DAYS=14

# Create a non-root user
RUN useradd -m -u 1000 vscode && \
    chown -R vscode:vscode /app
USER vscode

# Expose port
EXPOSE 8080

# Run the web interface
CMD ["python", "web-interface/app.py"]
